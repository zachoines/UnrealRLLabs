{
  "environment": {
    "name": "TerraShift",
    "id": "3",
    "params": {
      "PlatformSize": 1,
      "MaxColumnHeight": 4,
      "ObjectSize": [0.1, 0.1, 0.1],
      "ObjectMass": 0.1,
      "GridSize": 50,
      "MaxSteps": 512,
      "NumGoals": 4,
      "SpawnDelay": 0.25,
      "MaxAgents": 5,
      "GoalThreshold": 1.75,

      "MultiAgentFractalWave": {
        "num_agents": 5,
        "image_size": 50,
        "octaves": 3,
        "wrap_pos": true,
        "wrap_pitch": true,
        "wrap_yaw": true,
        "wrap_freq": true,
        "wrap_lacunarity": true,
        "wrap_gain": true,
        "wrap_blend_weight": true,

        "agent_init": {
          "pos_range": [-10, 10],
          "pitch_range": [-1.57, 1.57],
          "yaw_range": [0, 6.28318],
          "fov_deg": 60,
          "sample_dist": 10
        },
        "fractal_init": {
          "base_freq_range": [0.01, 2.0],
          "lacunarity_range": [1, 2],
          "gain_range": [0, 1],
          "blend_weight_range": [0, 5]
        },
        "action_ranges": {
          "pos_minmax": [-1, 1],
          "pitch_minmax": [-0.39, 0.39],
          "yaw_minmax": [-0.39, 0.39],
          "base_freq_minmax": [-0.02, 0.02],
          "lacunarity_minmax": [-0.02, 0.02],
          "gain_minmax": [-0.15, 0.15],
          "blend_weight_minmax": [-0.15, 0.15]
        },
        "state_ranges": {
          "pos_range": [-10, 10],
          "pitch_range": [-1.57, 1.57],
          "yaw_range": [0, 6.28318],
          "base_freq_range": [0.01, 2],
          "lacunarity_range": [1, 2],
          "gain_range": [0, 1],
          "blend_weight_range": [0, 5]
        }
      }
    },

    "shape": {
      "state": {
        "central": {
          "obs_size": 2500
        },
        "agent": {
          "obs_size": 28,
          "min": 5,
          "max": 5
        }
      },
      "action": {
        "agent": {
          "continuous": [
            { "min": -1, "max": 1 },
            { "min": -1, "max": 1 },
            { "min": -1, "max": 1 },
            { "min": -1, "max": 1 },
            { "min": -1, "max": 1 },
            { "min": -1, "max": 1 },
            { "min": -1, "max": 1 },
            { "min": -1, "max": 1 },
            { "min": -1, "max": 1 }
          ]
        }
      }
    }
  },

  "agent": {
    "type": "MA_POCA",
    "params": {
      "learning_rate": 0.0003,
      "gamma": 0.99,
      "lambda": 0.95,
      "value_loss_coeff": 0.5,
      "baseline_loss_coeff": 0.25,
      "normalize_advantages": true,
      "clipped_value_loss": true,
      "max_grad_norm": 0.5,
      "ppo_clip_range": 0.1,
      "value_clip_range": 0.2,
      "entropy_coeff": 0.005,
      "schedulers": {
        "lr": {
          "max_lr": 0.0003, 
          "total_steps": 10000, 
          "anneal_strategy": "cos", 
          "pct_start": 0.3, 
          "div_factor": 100,
          "final_div_factor": 10000
        },
        "entropy_coeff": {
          "max_value": 0.01, 
          "total_steps": 10000, 
          "pct_start": 0.3, 
          "div_factor": 10, 
          "final_div_factor": 100
        },
        "lr_disabled": {
          "start_factor": 1,
          "end_factor": 0.0001,
          "total_iters": 10000
        },
        "entropy_coeff_disabled": {
          "start_value": 0.01,
          "end_value": 0.001,
          "total_iters": 10000
        }
      },
      "networks": {
        "MultiAgentEmbeddingNetwork": {
          "cross_attention_feature_extractor" : {
            "obs_size": 28, 
            "num_agents": 5, 
            "h": 50,
            "w": 50, 
            "embed_dim": 64, 
            "num_heads": 4, 
            "cnn_channels": [32, 64], 
            "cnn_kernel_sizes": [5, 3], 
            "cnn_strides": [2, 2], 
            "transformer_layers": 2, 
            "scale_ratios": [0.25, 0.125, 0.0625],
            "top_k_scales": 2
          },
          "obs_encoder": {
            "state_dim": 64,
            "hidden_size": 64,
            "output_size": 64,
            "dropout_rate": 0,
            "activation": true,
            "layer_norm": false
          },
          "obs_actions_encoder": {
            "state_dim": 64,
            "action_dim": 9,
            "hidden_size": 64,
            "output_size": 64,
            "dropout_rate": 0,
            "activation": true,
            "layer_norm": false
          }
        },
        "policy_network": {
          "in_features": 64,
          "hidden_size": 128,
          "log_std_min": -20,
          "log_std_max": 2,
          "entropy_method": "mc",
          "n_entropy_samples": 10,
          "num_agents": 5
        },
        "critic_network": {
          "value_head": {
            "in_features": 64,
            "hidden_size": 64,
            "dropout_rate": 0
          },
          "baseline_head": {
            "in_features": 64,
            "hidden_size": 64,
            "dropout_rate": 0
          }
        }
      }
    }
  },

  "train": {
    "num_environments": 6,
    "epochs": 6,
    "mini_batch_size": 32,
    "buffer_size": 256,
    "batch_size": 256,
    "AgentsResetFrequency": 0,
    "ActionRepeat": 3,
    "saveFrequency": 20
  }
}
