{
  "environment": {
    "name": "TerraShift_8A_32x32_Test",
    "id": "TerraShift_8A_32x32_Test_$(date +%Y%m%d_%H%M%S)",
    "params": {
      "PlatformSize": 1.0,
      "MaxColumnHeight": 6.0,
      "ObjectMass": 1.0,
      "GridSize": 32,
      "MaxSteps": 512,
      "MaxAgents": 8,
      "TerraShiftEnvironment": {
        "bUseVelAlignment": false,
        "bUseXYDistanceImprovement": true,
        "bUseZAccelerationPenalty": false,
        "bUsePotentialShaping": false,
        "bUsePositivePotentialShaping": false,
        "bUseExponentialPotential": false,
        "PositivePotential_Power": 1.5,
        "PositivePotential_Sigma": 0.7,
        "bUseDistanceBasedReward": false,
        "bDisableEventRewards": false,
        "bUseStationaryPenalty": true,
        "StationaryPenalty_MinSpeed": 5.0,
        "StationaryPenalty_Drain": 0.01,
        "StationaryPenalty_MinConsecutiveFrames": 1,
        "PotentialShaping_Gamma": 0.97,
        "PotentialShaping_Scale": 1.0,
        "VelAlign_Scale": 0.05,
        "VelAlign_Min": -50.0,
        "VelAlign_Max": 50.0,
        "DistImprove_Scale": 100.0,
        "DistImprove_Min": -1.0,
        "DistImprove_Max": 1.0,
        "ZAccel_Scale": 0.0001,
        "ZAccel_Min": 0.1,
        "ZAccel_Max": 2000.0,
        "EventReward_GoalReached": 100.0,
        "EventReward_OutOfBounds": 25.0,
        "TimeStepPenalty": 0.01
      },
      "GoalManager": {
        "DefaultRadius": 1.0
      },
      "MultiAgentGaussianWaveHeightMap": {
        "NumAgents": 8,
        "GridSize": 32,
        "MinHeight": -6.0,
        "MaxHeight": 6.0,
        "NumActions": 6,
        "bUseActionDelta": true,
        "bAccumulatedWave": false,
        "AccumulatedWaveFadeGamma": 0.95,
        "bWrapAroundEdges": true,
        "VelMinMax": [
          -2,
          2
        ],
        "AngVelRange": [
          -1.57,
          1.57
        ],
        "AmpMinMax": [
          -6.0,
          6.0
        ],
        "SigMinMax": [
          0.5,
          3.0
        ],
        "DeltaVelScale": 2.0,
        "DeltaAngVelScale": 1.57,
        "DeltaAmpScale": 3.0,
        "DeltaSigmaScale": 1.0
      },
      "StateManager": {
        "MaxGridObjects": 4,
        "MarginXY": -1.0,
        "MinZ": 0.0,
        "MaxZ": 40.0,
        "SpawnPaddingZ": 3.0,
        "SpawnSeparationRadius": 7.0,
        "ObjectMass": 0.1,
        "MaxColumnHeight": 6.0,
        "BaseRespawnDelay": 0.1,
        "OverheadCameraDistance_disabled": 1500.0,
        "OverheadCameraFOV_disabled": 90.0,
        "OverheadCameraResX_disabled": 64,
        "OverheadCameraResY_disabled": 64,
        "bUseRandomGoals": true,
        "bRespawnOnGoal": false,
        "bRespawnOnOOB": false,
        "bTerminateOnAllGoalsReached": true,
        "bTerminateOnMaxSteps": false,
        "bRemoveObjectsOnGoal": true,
        "bSuppressPerStepGoalReward": true,
        "GoalRadius": 8.0,
        "ObjectRadius": 6.0,
        "GoalCollectRadius": 10.0,
        "GoalColors": [
          [
            1.0,
            0.0,
            1.0
          ],
          [
            1.0,
            1.0,
            0.0
          ],
          [
            0.0,
            1.0,
            1.0
          ],
          [
            0.0,
            1.0,
            0.0
          ]
        ],
        "GridObjectColors": [
          [
            1.0,
            0.0,
            1.0
          ],
          [
            1.0,
            1.0,
            0.0
          ],
          [
            0.0,
            1.0,
            1.0
          ],
          [
            0.0,
            1.0,
            0.0
          ]
        ],
        "bIncludeHeightMapInState": true,
        "StateHeightMapResolutionH": 64,
        "StateHeightMapResolutionW": 64,
        "bIncludeOverheadImageInState": false,
        "StateOverheadImageResX": 64,
        "StateOverheadImageResY": 64,
        "bIncludeGridObjectSequenceInState": true,
        "MaxGridObjectsForState": 4,
        "GridObjectFeatureSize": 9,
        "bRestrictColumnPhysicsToRadius": true,
        "ColumnCollisionRadiusCells": 3,
        "bEnabledShaderBasedHeightmap": true,
        "bRestrictColumnMovementToRadius": true
      }
    },
    "shape": {
      "state": {
        "central": [
          {
            "name": "height_map",
            "enabled": true,
            "type": "matrix2d",
            "shape": {
              "h": 64,
              "w": 64,
              "c": 1
            }
          },
          {
            "name": "greyscale_image",
            "enabled": false,
            "type": "matrix2d",
            "shape": {
              "h": 64,
              "w": 64,
              "c": 1
            }
          },
          {
            "name": "gridobject_sequence",
            "enabled": true,
            "type": "sequence",
            "shape": {
              "max_length": 4,
              "feature_dim": 9
            }
          }
        ],
        "agent": {
          "obs_size": 9,
          "min": 8,
          "max": 8
        }
      },
      "action": {
        "agent": {
          "continuous": [
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            }
          ]
        }
      }
    }
  },
  "StateRecorder": {
    "enabled": false,
    "video_settings": {
      "output_path": "Recordings\\TerraShift.mp4",
      "fps": 32,
      "dpi": 150
    },
    "auto_save_every": 1024,
    "components_to_record": [
      {
        "enabled": true,
        "source_key": "central",
        "component_name": "height_map",
        "visualization_type": "3d_surface",
        "plot_title": "Height Map Visualization",
        "shape_for_plot": {
          "h": 64,
          "w": 64,
          "c": 1
        },
        "z_lim_3d": [
          -1,
          1
        ],
        "cmap_3d": "terrain"
      }
    ]
  },
  "agent": {
    "type": "MA_POCA",
    "params": {
      "enable_memory": true,
      "memory_type": "gru",
      "gru": {
        "input_size": 256,
        "hidden_size": 256,
        "num_layers": 1,
        "bias": true,
        "dropout": 0.1
      },
      "disagreement_rewards_disabled": {
        "enabled": false,
        "reward_coeff": 0.1,
        "loss_coeff": 0.5,
        "normalize_reward": true,
        "ensemble_size": 8,
        "network": {
          "hidden_size": 64
        }
      },
      "rnd_rewards_disabled": {
        "enabled": true,
        "reward_coeff": 0.005,
        "loss_coeff": 1.0,
        "update_proportion": 0.25,
        "normalize_reward": true,
        "network": {
          "output_size": 128,
          "hidden_size": 256
        }
      },
      "rewards_normalizer_disabled": {
        "epsilon": 1e-05,
        "warmup_steps": 0
      },
      "enable_popart": false,
      "popart_beta": 0.995,
      "popart_epsilon": 0.0001,
      "learning_rate": 3e-04,
      "lr_policy": 3e-04,
      "lr_trunk": 3e-04,
      "lr_value_path": 3e-04,
      "lr_baseline_path": 1e-04,
      "lr_value_quantile": 3e-04,
      "lr_value_fraction": 5e-05,
      "lr_value_iqn": 3e-04,
      "lr_baseline_iqn": 3e-04,
      "lr_rnd_predictor": 3e-04,
      "lr_disagreement": 3e-04,
      "optimizer_betas": {
        "default": [
          0.9,
          0.999
        ]
      },
      "weight_decay": {
        "default": 0.0
      },
      "gamma": 0.985,
      "lmbda": 0.95,
      "value_loss_coeff": 1.0,
      "baseline_loss_coeff": 0.2,
      "normalize_advantages": true,
      "max_grad_norm": 1.0,
      "ppo_clip_range": 0.2,
      "value_clip_range": 1.0,
      "entropy_coeff": 0.01,
      "schedulers": {
        "lr_trunk": {
          "start_factor": 1.0,
          "end_factor": 0.5,
          "total_iters": 20000
        },
        "lr_policy": {
          "start_factor": 1.0,
          "end_factor": 0.5,
          "total_iters": 20000
        },
        "lr_value_path": {
          "start_factor": 1.0,
          "end_factor": 0.5,
          "total_iters": 20000
        },
        "lr_value_quantile": {
          "start_factor": 1.0,
          "end_factor": 0.3333,
          "total_iters": 20000
        },
        "lr_value_fraction": {
          "start_factor": 1.0,
          "end_factor": 0.5,
          "total_iters": 20000
        },
        "lr_baseline_path": {
          "start_factor": 1.0,
          "end_factor": 0.5,
          "total_iters": 20000
        },
        "lr_rnd_predictor": {
          "start_factor": 1.0,
          "end_factor": 0.5,
          "total_iters": 20000
        },
        "lr_disagreement": {
          "start_factor": 1.0,
          "end_factor": 0.5,
          "total_iters": 20000
        },
        "entropy_coeff": {
          "start_value": 0.005,
          "end_value": 0.0001,
          "total_iters": 20000
        },
        "policy_clip": {
          "start_value": 0.2,
          "end_value": 0.1,
          "total_iters": 20000
        },
        "value_clip": {
          "start_value": 1.0,
          "end_value": 0.1,
          "total_iters": 20000
        },
        "max_grad_norm": {
          "start_value": 3.0,
          "end_value": 1.0,
          "total_iters": 20000
        },
        "fqf_temperature": {
          "start_value": 6.0,
          "end_value": 4.0,
          "total_iters": 20000
        },
        "fqf_prior_blend_alpha": {
          "start_value": 0.3,
          "end_value": 0.15,
          "total_iters": 20000
        },
        "fraction_entropy_coeff": {
          "start_value": 0.08,
          "end_value": 0.02,
          "total_iters": 20000
        },
        "fraction_loss_coeff": {
          "start_value": 0.03,
          "end_value": 0.06,
          "total_iters": 20000
        },
        "rnd_reward_coeff": {
          "start_value": 0.005,
          "end_value": 0.0,
          "total_iters": 20000
        }
      },
      "networks": {
        "MultiAgentEmbeddingNetwork": {
          "cross_attention_feature_extractor": {
            "agent_obs_size": 9,
            "num_agents": 8,
            "embed_dim": 256,
            "num_heads": 8,
            "transformer_layers": 2,
            "dropout_rate": 0.1,
            "use_agent_id": true,
            "ff_hidden_factor": 2,
            "id_num_freqs": 8,
            "conv_init_scale": 1.0,
            "linear_init_scale": 1.0,
            "fusion_type": "parallel",
            "central_processing_configs": [
              {
                "name": "height_map",
                "enabled": false,
                "type": "cnn",
                "cnn_stem_channels": [
                  24,
                  48,
                  96
                ],
                "cnn_stem_kernels": [
                  5,
                  3,
                  3
                ],
                "cnn_stem_strides": [
                  2,
                  2,
                  2
                ],
                "cnn_stem_group_norms": [
                  6,
                  12,
                  24
                ],
                "target_pool_scale": 4,
                "add_spatial_coords_to_cnn_input": true,
                "swin_stages": [
                  {
                    "window_size": 4,
                    "num_heads": 4,
                    "merge": false
                  },
                  {
                    "window_size": 4,
                    "num_heads": 8,
                    "merge": true
                  },
                  {
                    "window_size": 2,
                    "num_heads": 8,
                    "merge": false
                  }
                ],
                "adaptive_tokenizer": {
                  "base_tokens": 12,
                  "min_tokens": 8,
                  "max_tokens": 20,
                  "importance_hidden": 96
                }
              },
              {
                "name": "gridobject_sequence",
                "enabled": true,
                "type": "linear_sequence",
                "linear_stem_hidden_sizes": [
                  128,
                  256
                ],
                "add_positional_encoding": true
              }
            ]
          },
          "obs_encoder": {
            "state_dim": 256,
            "hidden_size": 256,
            "output_size": 256,
            "dropout_rate": 0.1,
            "activation": true,
            "layer_norm": true
          },
          "obs_actions_encoder": {
            "state_dim": 256,
            "action_dim": 6,
            "hidden_size": 256,
            "output_size": 256,
            "dropout_rate": 0.1,
            "activation": true,
            "layer_norm": true
          }
        },
        "policy_network": {
          "type": "beta",
          "in_features": 256,
          "hidden_size": 256,
          "param_init_bias": 0.0,
          "min_concentration": 1.01,
          "linear_init_scale": 0.2,
          "dropout_rate": 0.1
        },
        "critic_network": {
          "baseline_head": {
            "in_features": 256,
            "hidden_size": 256,
            "dropout_rate": 0.0,
            "output_layer_init_gain": 1.0
          },
          "value_head": {
            "in_features": 256,
            "hidden_size": 256,
            "dropout_rate": 0.0,
            "output_layer_init_gain": 1.0
          },
          "value_attention": {
            "embed_dim": 256,
            "num_heads": 8,
            "dropout": 0.1,
            "self_attention": true
          },
          "baseline_attention": {
            "embed_dim": 256,
            "num_heads": 8,
            "dropout": 0.1,
            "self_attention": true
          },
          "distributional_network_params": {
            "fqf_network": {
              "feature_dim": 256,
              "hidden_size": 256,
              "quantile_embedding_dim": 64,
              "num_quantiles": 16,
              "use_dueling": true,
              "linear_init_scale": 1.0,
              "dropout_rate": 0.1,
              "iqn_kappa": 1.0,
              "fraction_net_hidden": 128,
              "fraction_loss_coeff": 0.03,
              "fraction_entropy_coeff": 0.08,
              "fqf_fraction_update_trunk": false,
              "fraction_entropy_warmup_iters": 5000,
              "fraction_entropy_cap": 0.5,
              "softmax_temperature": 6.0,
              "prior_blend_alpha": 0.3,
              "exploration_noise_scale": 0.02,
              "logit_clamp_epsilon": 1e-08,
              "monotonicity_epsilon": 1e-06
            }
          }
        }
      }
    }
  },
  "train": {
    "sequence_length": 32,
    "pad_trajectories": true,
    "batch_size": 256,
    "buffer_size": 256,
    "num_environments": 64,
    "epochs": 4,
    "mini_batch_size": 64,
    "ActionRepeat": 2,
    "saveFrequency": 27,
    "states_normalizer_disabled": {
      "epsilon": 1e-08,
      "warmup_steps": 0
    }
  },
  "test": {
    "enabled": true,
    "eval_only": false,
    "frequency": 27,
    "steps": 512
  }
}
