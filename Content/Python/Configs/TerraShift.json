{
  "environment": {
    "name": "TerraShift_TestD_IncreasedCapacity",
    "id": "TestD_IncreasedCapacity_$(date +%Y%m%d_%H%M%S)",
    "params": {
      "PlatformSize": 1,
      "MaxColumnHeight": 4,
      "ObjectSize": [
        0.1,
        0.1,
        0.1
      ],
      "ObjectMass": 0.1,
      "GridSize": 25,
      "MaxSteps": 1024,
      "MaxAgents": 8,
      "TerraShiftEnvironment": {
        "bUseVelAlignment": false,
        "bUseXYDistanceImprovement": false,
        "bUseZAccelerationPenalty": false,
        "bUsePotentialShaping": true,
        "VelAlign_Scale": 1.0,
        "VelAlign_Min": 0.001,
        "VelAlign_Max": 1.0,
        "DistImprove_Scale": 10.0,
        "DistImprove_Min": 0.0001,
        "DistImprove_Max": 1.0,
        "ZAccel_Scale": 0.10,
        "ZAccel_Min": 0.01,
        "ZAccel_Max": 100.0,
        "PotentialShaping_Gamma": 0.95,
        "PotentialShaping_Scale": 10.0,
        "REACH_GOAL_REWARD": 10.0,
        "FALL_OFF_PENALTY": -10.0,
        "STEP_PENALTY": 0.0
      },
      "GoalManager": {
        "DefaultRadius": 1.0
      },
      "MultiAgentGaussianWaveHeightMap": {
        "NumAgents": 8,
        "GridSize": 25,
        "MinHeight": -4.0,
        "MaxHeight": 4.0,
        "NumActions": 6,
        "bUseActionDelta": true,
        "bAccumulatedWave": false,
        "AccumulatedWaveFadeGamma": 0.95,
        "VelMinMax": [
          -10.0,
          10.0
        ],
        "AngVelRange": [
          -3.14,
          3.14
        ],
        "AmpMinMax": [
          -2.5,
          2.5
        ],
        "SigMinMax": [
          1.0,
          5.0
        ],
        "DeltaVelScale": 2.0,
        "DeltaAngVelScale": 0.628,
        "DeltaAmpScale": 0.5,
        "DeltaSigmaScale": 1.0
      },
      "StateManager": {
        "MaxGridObjects": 3,
        "MarginXY": 1.5,
        "MinZ": -4.0,
        "MaxZ": 20.0,
        "ObjectScale": 0.1,
        "ObjectMass": 0.1,
        "MaxColumnHeight": 4.0,
        "BaseRespawnDelay": 0.0,
        "OverheadCameraDistance": 100.0,
        "OverheadCameraFOV": 60.0,
        "OverheadCameraResX": 25,
        "OverheadCameraResY": 25,
        "bUseRandomGoals": true,
        "bRemoveGridObjectOnGoalReached": true,
        "bRemoveGridObjectOnOOB": true,
        "bRespawnGridObjectOnGoalReached": false,
        "GoalRadius": 4,
        "ObjectRadius": 6,
        "GoalCollectRadius": 14,
        "GoalColors": [
          [
            1.0,
            0.0,
            0.0
          ],
          [
            0.0,
            1.0,
            0.0
          ],
          [
            0.0,
            0.0,
            1.0
          ]
        ],
        "GridObjectColors": [
          [
            1.0,
            0.0,
            0.0
          ],
          [
            0.0,
            1.0,
            0.0
          ],
          [
            0.0,
            0.0,
            1.0
          ]
        ]
      }
    },
    "shape": {
      "state": {
        "central": {
          "obs_size": 1250
        },
        "agent": {
          "obs_size": 9,
          "min": 8,
          "max": 8
        }
      },
      "action": {
        "agent": {
          "continuous": [
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            },
            {
              "min": -1,
              "max": 1
            }
          ]
        }
      }
    }
  },
  "StateRecorder_disabled": {
    "height_map": {
      "grid_h": 25,
      "grid_w": 25,
      "num_channels": 2,
      "height_channel_index": 0,
      "clip_value": 1.0
    },
    "video": {
      "fps": 18,
      "output_path": "height_auto.mp4"
    },
    "auto_save_every": 128
  },
  "agent": {
    "type": "MA_POCA",
    "params": {
      "enable_memory": true,
      "memory_type": "gru",
      "gru": {
        "input_size": 128,
        "hidden_size": 128,
        "num_layers": 2,
        "bias": true,
        "dropout": 0.0
      },
      "enable_rnd": false,
      "rnd_params": {
        "output_size": 128,
        "hidden_size": 128,
        "intrinsic_reward_coeff": 0.001,
        "rnd_update_proportion": 0.25
      },
      "enable_iqn_distillation": true,
      "enable_popart": true,
      "popart_beta": 0.999,
      "popart_epsilon": 1e-5,
      "no_grad_forward_batch_size": 16,
      "learning_rate": 0.0001,
      "lr_policy": 0.0001,
      "lr_value": 0.00005,
      "lr_baseline": 0.00005,
      "lr_rnd_predictor": 0.00005,
      "lr_iqn": 0.00005,
      "optimizer_betas": {
        "trunk": [0.9, 0.98],
        "policy": [0.9, 0.98],
        "value": [0.9, 0.95],
        "baseline": [0.9, 0.95],
        "iqn": [0.9,0.98],
        "rnd": [0.9, 0.98]
      },
      "weight_decay": {
        "trunk": 1e-5,
        "policy": 1e-5,
        "value": 1e-4,
        "baseline": 1e-4,
        "iqn": 0.0,
        "rnd": 0.0
      },
      "gamma": 0.95,
      "lambda": 0.9,
      "value_loss_coeff": 0.5,
      "baseline_loss_coeff": 0.5,
      "iqn_loss_coeff": 0.25,
      "normalize_advantages": true,
      "clipped_value_loss": true,
      "max_grad_norm": 0.5,
      "iqn_max_grad_norm": 0.5,
      "ppo_clip_range": 0.2,
      "value_clip_range": 0.1,
      "entropy_coeff": 0.001,
      "rewards_normalizer_disabled": {
        "warmup_steps": 2000,
        "epsilon": 1e-8
      },
      "schedulers": {
        "lr_trunk": { "start_factor": 1.0, "end_factor": 0.1, "total_iters": 20000 },
        "lr_policy": { "start_factor": 1.0, "end_factor": 0.1, "total_iters": 20000 },
        "lr_value": { "start_factor": 1.0, "end_factor": 0.1, "total_iters": 20000 },
        "lr_baseline": { "start_factor": 1.0, "end_factor": 0.1, "total_iters": 20000 },
        "lr_rnd_predictor": { "start_factor": 1.0, "end_factor": 0.1, "total_iters": 20000 },
        "lr_iqn": { "start_factor": 1.0, "end_factor": 0.1, "total_iters": 20000 },
        "entropy_coeff": { "start_value": 0.005, "end_value": 0.0001, "total_iters": 20000 },
        "value_clip": { "start_value": 0.2, "end_value": 0.1, "total_iters": 20000 },
        "policy_clip": { "start_value": 0.2, "end_value": 0.1, "total_iters": 20000 },
        "max_grad_norm": { "start_value": 1.0, "end_value": 0.5, "total_iters": 20000 }
      },
      "networks": {
        "MultiAgentEmbeddingNetwork": {
          "cross_attention_feature_extractor": {
            "agent_obs_size": 9,
            "num_agents": 8,
            "in_channels": 2,
            "h": 25,
            "w": 25,
            "embed_dim": 128,
            "num_heads": 8,
            "cnn_channels": [64, 128],
            "cnn_kernel_sizes": [5, 3],
            "cnn_strides": [2, 1],
            "group_norms": [8, 16],
            "block_scales": [8, 8],
            "transformer_layers": 3,
            "dropout_rate": 0.0,
            "use_agent_id": true,
            "ff_hidden_factor": 2,
            "id_num_freqs": 16,
            "conv_init_scale": 0.1,
            "linear_init_scale": 0.1
          },
          "obs_encoder": {
            "state_dim": 128,
            "hidden_size": 128,
            "output_size": 128,
            "dropout_rate": 0.0,
            "activation": true,
            "layer_norm": false,
            "linear_init_scale": 0.1
          },
          "obs_actions_encoder": {
            "state_dim": 128,
            "action_dim": 6,
            "hidden_size": 128,
            "output_size": 128,
            "dropout_rate": 0.0,
            "activation": true,
            "layer_norm": false,
            "linear_init_scale": 0.1
          }
        },
        "policy_network": {
          "in_features": 128,
          "hidden_size": 256,
          "param_init_bias": 1.0,
          "min_concentration": 1.001,
          "linear_init_scale": 0.01,
          "dropout_rate": 0.0
        },
        "critic_network": {
          "feature_dim_for_iqn": 128,
          "linear_init_scale": 0.1,
          "value_head": {
            "in_features": 128,
            "hidden_size": 256,
            "dropout_rate": 0.0,
            "linear_init_scale": 0.01,
            "output_layer_init_gain": 0.01
          },
          "baseline_head": {
            "in_features": 128,
            "hidden_size": 256,
            "dropout_rate": 0.0,
            "linear_init_scale": 0.01,
            "output_layer_init_gain": 0.01
          },
          "value_attention": {
            "embed_dim": 128,
            "num_heads": 8,
            "dropout": 0.0,
            "self_attention": true
          },
          "baseline_attention": {
            "embed_dim": 128,
            "num_heads": 8,
            "dropout": 0.0,
            "self_attention": true
          },
          "iqn_params": {
            "num_quantiles": 32,
            "num_quantiles_prime": 32,
            "quantile_embedding_dim": 128,
            "hidden_size": 128,
            "dropout_rate": 0.0,
            "kappa": 1.0,
            "polyak_tau": 0.005
          },
          "distillation_params": {
            "hidden_size": 128,
            "combination_method": "hadamard_product",
            "dropout_rate": 0.0
          }
        }
      }
    }
  },
  "train": {
    "sequence_length": 64,
    "pad_trajectories": true,
    "batch_size": 256,
    "buffer_size": 256,
    "num_environments": 8,
    "epochs": 4,
    "mini_batch_size": 16,
    "ActionRepeat": 1,
    "saveFrequency": 100,
    "iqn_target_update_freq": 10,
    "iqn_train_freq": 1,
    "iqn_replay_buffer_size": 100000,
    "iqn_batch_size": 128,
    "iqn_epochs": 4
  }
}