{
  "environment": {
    "name": "TerraShift_8A_4O_IQN_Disagree_Balanced_V3",
    "id": "TerraShift_8A_4O_IQN_Disagree_HM_Balanced_V3_$(date +%Y%m%d_%H%M%S)",
    "params": {
      "PlatformSize": 1.0,
      "MaxColumnHeight": 4.0,
      "ObjectSize": [0.1, 0.1, 0.1],
      "ObjectMass": 0.1,
      "GridSize": 25,
      "MaxSteps": 512,
      "MaxAgents": 8,
      "TerraShiftEnvironment": {
        "bUseVelAlignment": true,
        "bUseXYDistanceImprovement": true,
        "bUseZAccelerationPenalty": false,
        "bUsePotentialShaping": true,
        "PotentialShaping_Gamma": 0.99,
        "PotentialShaping_Scale": 0.01,

        "VelAlign_Scale": 0.01,
        "VelAlign_Min": 0.0001,
        "VelAlign_Max": 1.0,

        "DistImprove_Scale": 1.0,
        "DistImprove_Min": 0.0001,
        "DistImprove_Max": 0.1,

        "REACH_GOAL_REWARD": 1.0,
        "FALL_OFF_PENALTY": -1.0,
        "STEP_PENALTY": 0.0
      },
      "GoalManager": {
        "DefaultRadius": 1.0
      },
      "MultiAgentGaussianWaveHeightMap": {
        "NumAgents": 8,
        "GridSize": 25,
        "MinHeight": -4.0,
        "MaxHeight": 4.0,
        "NumActions": 6,
        "bUseActionDelta": true,
        "bAccumulatedWave": false,
        "AccumulatedWaveFadeGamma": 0.95,
        "VelMinMax": [-8.0, 8.0],
        "AngVelRange": [-2.0, 2.0],
        "AmpMinMax": [-4.0, 4.0],
        "SigMinMax": [1.5, 4.0],
        "DeltaVelScale": 0.8,
        "DeltaAngVelScale": 1.0,
        "DeltaAmpScale": 0.8,
        "DeltaSigmaScale": 0.5
      },
      "StateManager": {
        "MaxGridObjects": 4,
        "MarginXY": 1.5,
        "MinZ": -4.0,
        "MaxZ": 20.0,
        "ObjectScale": 0.1,
        "ObjectMass": 0.1,
        "MaxColumnHeight": 4.0,
        "BaseRespawnDelay": 0.0,
        "bUseRandomGoals": true,
        "bRemoveGridObjectOnGoalReached": true,
        "bRemoveGridObjectOnOOB": true,
        "bRespawnGridObjectOnGoalReached": false,
        "GoalRadius": 4,
        "ObjectRadius": 3,
        "GoalCollectRadius": 4.5,
        "GoalColors": [
            [0.0, 1.0, 0.0], [1.0, 0.0, 1.0], [1.0, 0.5, 0.0], [0.5, 0.0, 1.0]
        ],
        "GridObjectColors": [
            [0.0, 1.0, 0.0], [1.0, 0.0, 1.0], [1.0, 0.5, 0.0], [0.5, 0.0, 1.0]
        ],
        "bIncludeHeightMapInState": true,
        "StateHeightMapResolutionH": 25,
        "StateHeightMapResolutionW": 25,
        "bIncludeOverheadImageInState": false,
        "StateOverheadImageResX": 25,
        "StateOverheadImageResY": 25,
        "bIncludeGridObjectSequenceInState": true,
        "MaxGridObjectsForState": 4,
        "GridObjectFeatureSize": 9
      }
    },
    "shape": {
      "state": {
        "central": [
          { "name": "height_map", "enabled": true, "type": "matrix2d", "shape": { "h": 25, "w": 25, "c": 1 } },
          { "name": "greyscale_image", "enabled": false, "type": "matrix2d", "shape": { "h": 25, "w": 25, "c": 1 } },
          { "name": "gridobject_sequence", "enabled": true, "type": "sequence", "shape": { "max_length": 4, "feature_dim": 9 } }
        ],
        "agent": { "obs_size": 9, "min": 8, "max": 8 }
      },
      "action": { "agent": { "continuous": [ {"min": -1, "max": 1},{"min": -1, "max": 1},{"min": -1, "max": 1}, {"min": -1, "max": 1},{"min": -1, "max": 1},{"min": -1, "max": 1} ] } }
    }
  },
  "StateRecorder": { "enabled": false },
  "agent": {
    "type": "MA_POCA",
    "params": {
      "enable_memory": true,
      "memory_type": "gru",
      "gru": {"input_size": 128, "hidden_size": 128, "num_layers": 1, "bias": true, "dropout": 0.0},
      "enable_rnd": false,
      "enable_iqn_distillation": true,
      "enable_disagreement": true,
      "enable_popart": true,
      "disagreement_params": {
        "ensemble_size": 5,
        "disagreement_reward_coeff": 0.0001
      },
      "disagreement_loss_coeff": 0.1,
      "learning_rate": 2.5e-4, "lr_policy": 2.5e-4, "lr_value_path": 2.5e-4,
      "lr_baseline_path": 2.5e-4, "lr_trunk": 1e-4,
      "lr_rnd_predictor": 2.5e-4, "lr_value_iqn": 2.5e-4, "lr_baseline_iqn": 2.5e-4,
      "lr_disagreement": 5e-5,
      "optimizer_betas": { "default": [0.9, 0.99] },
      "weight_decay": { "default": 1e-6 },
      "gamma": 0.99, "lambda": 0.85,
      "value_loss_coeff": 0.5, "baseline_loss_coeff": 0.25,
      "value_iqn_loss_coeff": 0.5, "baseline_iqn_loss_coeff": 0.25,
      "normalize_advantages": false, "clipped_value_loss": true,
      "max_grad_norm": 0.5, "iqn_max_grad_norm": 0.5,
      "ppo_clip_range": 0.2, "value_clip_range": 0.2, "entropy_coeff": 0.02,
      "rewards_normalizers": { "warmup_steps": 0 },
      "schedulers": {
        "lr_trunk": { "start_factor": 1.0, "end_factor": 0.1, "total_iters": 100000 },
        "lr_policy": { "start_factor": 1.0, "end_factor": 0.1, "total_iters": 100000 },
        "entropy_coeff": { "start_value": 0.001, "end_value": 0.0001, "total_iters": 80000 },
        "ppo_clip_range": { "start_value": 0.2, "end_value": 0.1, "total_iters": 80000 },
        "value_clip_range": { "start_value": 0.2, "end_value": 0.1, "total_iters": 80000 }
      },
      "networks": {
        "MultiAgentEmbeddingNetwork": {
          "cross_attention_feature_extractor": {
            "agent_obs_size": 9, "num_agents": 8, "embed_dim": 128, "num_heads": 8, "transformer_layers": 1, "dropout_rate": 0.0, "use_agent_id": true, "ff_hidden_factor": 2, "id_num_freqs": 8, "conv_init_scale": 1.0, "linear_init_scale": 1.0,
            "central_processing_configs": [
              { "name": "height_map", "enabled": true, "type": "cnn", "cnn_stem_channels": [32, 64], "cnn_stem_kernels": [3, 3], "cnn_stem_strides": [1, 1], "cnn_stem_group_norms": [8, 16], "cnn_stem_target_pool_scale": 8, "add_spatial_coords_to_cnn_input": true },
              { "name": "gridobject_sequence", "enabled": true, "type": "linear_sequence", "linear_stem_hidden_sizes": [128, 128], "add_positional_encoding": true }
            ]
          },
          "obs_encoder": { "state_dim": 128, "hidden_size": 128, "output_size": 128, "dropout_rate": 0.0, "activation": true, "layer_norm": true, "linear_init_scale": 1.0 },
          "obs_actions_encoder": { "state_dim": 128, "action_dim": 6, "hidden_size": 128, "output_size": 128, "dropout_rate": 0.0, "activation": true, "layer_norm": true, "linear_init_scale": 1.0 }
        },
        "policy_network": { "type": "beta", "in_features": 128, "hidden_size": 128, "param_init_bias": 0.0, "min_concentration": 1.001, "linear_init_scale": 0.1, "dropout_rate": 0.0 },
        "critic_network": {
          "feature_dim_for_iqn": 128, "linear_init_scale": 1.0,
          "value_head": {"in_features": 128, "hidden_size": 128, "dropout_rate": 0.0, "linear_init_scale": 1.0, "output_layer_init_gain": 0.1},
          "baseline_head": {"in_features": 128, "hidden_size": 128, "dropout_rate": 0.0, "linear_init_scale": 1.0, "output_layer_init_gain": 0.1},
          "value_attention": {"embed_dim": 128, "num_heads": 8, "dropout": 0.0, "self_attention": true},
          "baseline_attention": {"embed_dim": 128, "num_heads": 8, "dropout": 0.0, "self_attention": true},
          "iqn_params": { "num_quantiles": 32, "num_quantiles_prime": 32, "quantile_embedding_dim": 128, "hidden_size": 128, "dropout_rate": 0.0, "kappa": 1.0, "polyak_tau": 0.005 },
          "distillation_params": {"hidden_size": 128, "combination_method": "hadamard_product", "dropout_rate": 0.0}
        }
      }
    }
  },
  "train": {
    "sequence_length": 16, "pad_trajectories": true, "batch_size": 512, "buffer_size": 512,
    "num_environments": 4, "epochs": 4, "mini_batch_size": 32, "ActionRepeat": 3, "saveFrequency": 50,
    "iqn_target_update_freq": 3, "iqn_train_freq": 1, "iqn_replay_buffer_size": 50000, "iqn_batch_size": 64, "iqn_epochs": 3
  }
}