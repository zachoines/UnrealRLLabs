{
    "environment": {
        "name": "TerraShift_16A_4O_MemSave_Test",
        "id": "TerraShift_16A_4O_MemSave_Test_$(date +%Y%m%d_%H%M%S)",
        "params": {
            "PlatformSize": 1.0,
            "MaxColumnHeight": 4.0,
            "ObjectSize": [
                0.15,
                0.15,
                0.15
            ],
            "ObjectMass": 0.1,
            "GridSize": 15,
            "MaxSteps": 512,
            "MaxAgents": 16,
            "TerraShiftEnvironment": {
                "bUseVelAlignment": true,
                "bUseXYDistanceImprovement": false,
                "bUseZAccelerationPenalty": false,
                "bUsePotentialShaping": true,
                "PotentialShaping_Gamma": 0.99,
                "PotentialShaping_Scale": 1.0,
                "VelAlign_Scale": 0.01,
                "VelAlign_Min": 0.0,
                "VelAlign_Max": 100.0,
                "DistImprove_Scale": 0.1,
                "DistImprove_Min": 0.0,
                "DistImprove_Max": 1.0,
                "REACH_GOAL_REWARD": 0.0,
                "FALL_OFF_PENALTY": 0.0,
                "STEP_PENALTY": -0.0001
            },
            "GoalManager": {
                "DefaultRadius": 1.0
            },
            "MultiAgentGaussianWaveHeightMap": {
                "NumAgents": 16,
                "GridSize": 15,
                "MinHeight": -6.0,
                "MaxHeight": 6.0,
                "NumActions": 6,
                "bUseActionDelta": true,
                "bAccumulatedWave": false,
                "AccumulatedWaveFadeGamma": 0.95,
                "VelMinMax": [
                    -10.0,
                    10.0
                ],
                "AngVelRange": [
                    -3.14,
                    3.14
                ],
                "AmpMinMax": [
                    -5.0,
                    5.0
                ],
                "SigMinMax": [
                    1,
                    5.0
                ],
                "DeltaVelScale": 4.0,
                "DeltaAngVelScale": 1.256,
                "DeltaAmpScale": 2.0,
                "DeltaSigmaScale": 1.0
            },
            "StateManager": {
                "MaxGridObjects": 4,
                "MarginXY": 1.5,
                "MinZ": -4.0,
                "MaxZ": 50.0,
                "ObjectScale": 0.15,
                "ObjectMass": 0.1,
                "MaxColumnHeight": 6.0,
                "BaseRespawnDelay": 0.0,
                "bUseRandomGoals": true,
                "bRemoveGridObjectOnGoalReached": true,
                "bRemoveGridObjectOnOOB": true,
                "bRespawnGridObjectOnGoalReached": false,
                "GoalRadius": 7,
                "ObjectRadius": 7,
                "GoalCollectRadius": 10,
                "GoalColors": [
                    [
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "GridObjectColors": [
                    [
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "bIncludeHeightMapInState": true,
                "StateHeightMapResolutionH": 60,
                "StateHeightMapResolutionW": 60,
                "bIncludeOverheadImageInState": false,
                "StateOverheadImageResX": 60,
                "StateOverheadImageResY": 60,
                "bIncludeGridObjectSequenceInState": true,
                "MaxGridObjectsForState": 4,
                "GridObjectFeatureSize": 9
            }
        },
        "shape": {
            "state": {
                "central": [
                    {
                        "name": "height_map",
                        "enabled": true,
                        "type": "matrix2d",
                        "shape": {
                            "h": 60,
                            "w": 60,
                            "c": 1
                        }
                    },
                    {
                        "name": "greyscale_image",
                        "enabled": false,
                        "type": "matrix2d",
                        "shape": {
                            "h": 60,
                            "w": 60,
                            "c": 1
                        }
                    },
                    {
                        "name": "gridobject_sequence",
                        "enabled": true,
                        "type": "sequence",
                        "shape": {
                            "max_length": 4,
                            "feature_dim": 9
                        }
                    }
                ],
                "agent": {
                    "obs_size": 9,
                    "min": 16,
                    "max": 16
                }
            },
            "action": {
                "agent": {
                    "continuous": [
                        { "min": -1, "max": 1 },
                        { "min": -1, "max": 1 },
                        { "min": -1, "max": 1 },
                        { "min": -1, "max": 1 },
                        { "min": -1, "max": 1 },
                        { "min": -1, "max": 1 }
                    ]
                }
            }
        }
    },
    "StateRecorder": {
        "enabled": false,
        "video_settings": {
            "output_path": "recordings/TerraShift.mp4",
            "fps": 30,
            "dpi": 150
        },
        "auto_save_every": 128,
        "components_to_record": [
            {
                "enabled": false,
                "source_key": "central",
                "component_name": "height_map",
                "visualization_type": "3d_surface",
                "plot_title": "Height Map Visualization",
                "shape_for_plot": {
                    "h": 60,
                    "w": 60,
                    "c": 1
                },
                "z_lim_3d": [
                    -1.5,
                    1.5
                ],
                "cmap_3d": "terrain"
            }
        ]
    },
    "agent": {
        "type": "MA_POCA",
        "params": {
            "enable_memory": true,
            "memory_type": "gru",
            "gru": {
                "input_size": 64,
                "hidden_size": 64,
                "num_layers": 2,
                "bias": true,
                "dropout": 0.1
            },
            "disagreement_rewards": {
                "reward_coeff": 0.001,
                "loss_coeff": 0.1,
                "normalize_reward": false,
                "ensemble_size": 5,
                "network": {
                    "hidden_size": 256
                }
            },
            "rnd_rewards": {
                "reward_coeff": 0.01,
                "loss_coeff": 1.0,
                "update_proportion": 0.25,
                "normalize_reward": true,
                "network": {
                    "output_size": 128,
                    "hidden_size": 256
                }
            },

            "enable_popart": false,
            
            "learning_rate": 2e-05,
            "lr_policy": 2e-05,
            "lr_trunk": 2e-05,
            "lr_value_path": 2e-05,
            "lr_baseline_path": 2e-05,
            "lr_value_iqn": 2e-05,
            "lr_baseline_iqn": 2e-05,
            "lr_rnd_predictor": 2e-05,
            "lr_disagreement": 2e-05,
            "optimizer_betas": {
                "default": [
                    0.9,
                    0.999
                ],
                "policy": [
                    0.9,
                    0.999
                ],
                "trunk": [
                    0.9,
                    0.999
                ]
            },
            "weight_decay": { 
              "default": 0.0, 
              "trunk": 0.0, 
              "policy": 0.0, 
              "value_path": 0.0, 
              "baseline_path": 0.0 
            },
            "gamma": 0.99,
            "lambda": 0.9,
            "value_loss_coeff": 1.0,
            "baseline_loss_coeff": 0.25,
            "normalize_advantages": true,
            "clipped_value_loss": true,
            "max_grad_norm": 0.5,
            "ppo_clip_range": 0.2,
            "value_clip_range": 0.2,
            "entropy_coeff": 0.01,
            "rewards_normalizer_disabled": {
                "warmup_steps": 0
            },
            "schedulers": {
              "lr_trunk": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_policy": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_value_path": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_baseline_path": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_value_iqn": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_baseline_iqn": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_disagreement": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "entropy_coeff": {
                    "start_value": 0.01,
                    "end_value": 0.001,
                    "total_iters": 10000
                },
                "policy_clip": {
                    "start_value": 0.1,
                    "end_value": 0.05,
                    "total_iters": 10000
                },
                "value_clip": {
                    "start_value": 0.1,
                    "end_value": 0.01,
                    "total_iters": 10000
                }
            },
            "networks": {
                "MultiAgentEmbeddingNetwork": {
                    "cross_attention_feature_extractor": {
                        "agent_obs_size": 9,
                        "num_agents": 16,
                        "embed_dim": 64,
                        "num_heads": 4,
                        "transformer_layers": 2,
                        "dropout_rate": 0.1,
                        "use_agent_id": true,
                        "ff_hidden_factor": 2,
                        "id_num_freqs": 8,
                        "conv_init_scale": 1.0,
                        "linear_init_scale": 1.0,
                        "central_processing_configs": [
                            {
                                "name": "height_map",
                                "enabled": true,
                                "type": "cnn",
                                "cnn_stem_channels": [ 32, 64, 64 ],
                                "cnn_stem_kernels": [ 8, 4, 3 ],
                                "cnn_stem_strides": [ 4, 2, 1 ],
                                "cnn_stem_group_norms": [ 8, 16, 16 ],
                                "add_spatial_coords_to_cnn_input": true
                            },
                            {
                                "name": "gridobject_sequence",
                                "enabled": true,
                                "type": "linear_sequence",
                                "linear_stem_hidden_sizes": [ 128, 128 ],
                                "add_positional_encoding": true
                            }
                        ]
                    },
                    "obs_encoder": {
                        "state_dim": 64,
                        "hidden_size": 64,
                        "output_size": 64,
                        "dropout_rate": 0.1,
                        "activation": true,
                        "layer_norm": true
                    },
                    "obs_actions_encoder": {
                        "state_dim": 64,
                        "action_dim": 6,
                        "hidden_size": 64,
                        "output_size": 64,
                        "dropout_rate": 0.1,
                        "activation": true,
                        "layer_norm": true
                    }
                },
                "policy_network": {
                    "type": "beta",
                    "in_features": 64,
                    "hidden_size": 128,
                    "param_init_bias": 0.0,
                    "min_concentration": 1.001,
                    "linear_init_scale": 0.1,
                    "dropout_rate": 0.1
                },
                "critic_network": {
                    "feature_dim_for_iqn": 64,
                    "value_head": {
                        "in_features": 64,
                        "hidden_size": 128,
                        "dropout_rate": 0.1
                    },
                    "baseline_head": {
                        "in_features": 64,
                        "hidden_size": 128,
                        "dropout_rate": 0.1
                    },
                    "value_attention": {
                        "embed_dim": 64,
                        "num_heads": 4,
                        "dropout": 0.1,
                        "self_attention": true
                    },
                    "baseline_attention": {
                        "embed_dim": 64,
                        "num_heads": 4,
                        "dropout": 0.1,
                        "self_attention": true
                    }
                }
            }
        }
    },
    "train": {
        "sequence_length": 8,
        "pad_trajectories": true,
        "batch_size": 128,
        "buffer_size": 128,
        "num_environments": 4,
        "epochs": 3,
        "mini_batch_size": 8,
        "ActionRepeat": 8,
        "saveFrequency": 50
    }
}