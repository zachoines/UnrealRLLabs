{
    "environment": {
        "name": "TerraShift_8A_2O_Test",
        "id": "TerraShift_8A_2O_Test_$(date +%Y%m%d_%H%M%S)",
        "params": {
            "PlatformSize": 1.0,
            "MaxColumnHeight": 6.0,
            "ObjectSize": [
                0.15,
                0.15,
                0.15
            ],
            "ObjectMass": 0.1,
            "GridSize": 15,
            "MaxSteps": 512,
            "MaxAgents": 8,
            "TerraShiftEnvironment": {
                "bUseVelAlignment": true,
                "bUseXYDistanceImprovement": false,
                "bUseZAccelerationPenalty": false,
                "bUsePotentialShaping": false,
                "PotentialShaping_Gamma": 0.99,
                "PotentialShaping_Scale": 1.0,
                "VelAlign_Scale": 1.0,
                "VelAlign_Min": 0.0,
                "VelAlign_Max": 100.0,
                "DistImprove_Scale": 0.1,
                "DistImprove_Min": 0.0,
                "DistImprove_Max": 1.0,
                "ZAccel_Scale_disabled": 0.0001,
                "ZAccel_Min_disabled": 0.1,
                "ZAccel_Max_disabled": 2000.0,
                "REACH_GOAL_REWARD": 10.0,
                "FALL_OFF_PENALTY": -10.0,
                "STEP_PENALTY": 0.0
            },
            "GoalManager": {
                "DefaultRadius": 1.0
            },
            "MultiAgentGaussianWaveHeightMap": {
                "NumAgents": 8,
                "GridSize": 15,
                "MinHeight": -6.0,
                "MaxHeight": 6.0,
                "NumActions": 6,
                "bUseActionDelta": true,
                "bAccumulatedWave": false,
                "AccumulatedWaveFadeGamma": 0.95,
                "bWrapAroundEdges_disabled": true,
                "VelMinMax": [
                    -10.0,
                    10.0
                ],
                "AngVelRange": [
                    -3.14,
                    3.14
                ],
                "AmpMinMax": [
                    -5.0,
                    5.0
                ],
                "SigMinMax": [
                    1.0,
                    5.0
                ],
                "DeltaVelScale": 4.0,
                "DeltaAngVelScale": 1.256,
                "DeltaAmpScale": 2.0,
                "DeltaSigmaScale": 1.0
            },
            "StateManager": {
                "MaxGridObjects": 2,
                "MarginXY": 1.5,
                "MinZ": -4.0,
                "MaxZ": 50.0,
                "MarginCells_disabled": 2,
                "ObjectScale": 0.15,
                "ObjectMass": 0.1,
                "MaxColumnHeight": 6.0,
                "BaseRespawnDelay": 0.0,
                "OverheadCameraDistance_disabled": 1500.0,
                "OverheadCameraFOV_disabled": 90.0,
                "OverheadCameraResX_disabled": 25,
                "OverheadCameraResY_disabled": 25,
                "bUseRandomGoals": true,
                "bRemoveGridObjectOnGoalReached": true,
                "bRemoveGridObjectOnOOB": true,
                "bRespawnGridObjectOnGoalReached": false,
                "GoalRadius": 7.0,
                "ObjectRadius": 7.0,
                "GoalCollectRadius": 10.0,
                "GoalColors": [
                    [
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "GridObjectColors": [
                    [
                        1.0,
                        0.0,
                        0.0
                    ],
                    [
                        0.0,
                        0.0,
                        1.0
                    ]
                ],
                "bIncludeHeightMapInState": true,
                "StateHeightMapResolutionH": 60,
                "StateHeightMapResolutionW": 60,
                "bIncludeOverheadImageInState": false,
                "StateOverheadImageResX": 60,
                "StateOverheadImageResY": 60,
                "bIncludeGridObjectSequenceInState": true,
                "MaxGridObjectsForState": 2,
                "GridObjectFeatureSize": 9
            }
        },
        "shape": {
            "state": {
                "central": [
                    {
                        "name": "height_map",
                        "enabled": true,
                        "type": "matrix2d",
                        "shape": {
                            "h": 60,
                            "w": 60,
                            "c": 1
                        }
                    },
                    {
                        "name": "greyscale_image",
                        "enabled": false,
                        "type": "matrix2d",
                        "shape": {
                            "h": 60,
                            "w": 60,
                            "c": 1
                        }
                    },
                    {
                        "name": "gridobject_sequence",
                        "enabled": true,
                        "type": "sequence",
                        "shape": {
                            "max_length": 2,
                            "feature_dim": 9
                        }
                    }
                ],
                "agent": {
                    "obs_size": 9,
                    "min": 8,
                    "max": 8
                }
            },
            "action": {
                "agent": {
                    "continuous": [
                        {
                            "min": -1,
                            "max": 1
                        },
                        {
                            "min": -1,
                            "max": 1
                        },
                        {
                            "min": -1,
                            "max": 1
                        },
                        {
                            "min": -1,
                            "max": 1
                        },
                        {
                            "min": -1,
                            "max": 1
                        },
                        {
                            "min": -1,
                            "max": 1
                        }
                    ]
                }
            }
        }
    },
    "StateRecorder": {
        "enabled": false,
        "video_settings": {
            "output_path": "recordings/TerraShift.mp4",
            "fps": 30,
            "dpi": 150
        },
        "auto_save_every": 128,
        "components_to_record": [
            {
                "enabled": false,
                "source_key": "central",
                "component_name": "height_map",
                "visualization_type": "3d_surface",
                "plot_title": "Height Map Visualization",
                "shape_for_plot": {
                    "h": 60,
                    "w": 60,
                    "c": 1
                },
                "z_lim_3d": [
                    -1.5,
                    1.5
                ],
                "cmap_3d": "terrain"
            }
        ]
    },
    "agent": {
        "type": "MA_POCA",
        "params": {
            "enable_memory": true,
            "memory_type": "gru",
            "gru": {
                "input_size": 48,
                "hidden_size": 48,
                "num_layers": 2,
                "bias": true,
                "dropout": 0.1
            },
            "enable_iqn_distillation": false,
            "disagreement_rewards": {
                "enabled": false,
                "reward_coeff": 0.001,
                "loss_coeff": 0.1,
                "normalize_reward": false,
                "ensemble_size": 5,
                "network": {
                    "hidden_size": 256
                }
            },
            "rnd_rewards": {
                "enabled": false,
                "reward_coeff": 0.01,
                "loss_coeff": 1.0,
                "update_proportion": 0.25,
                "normalize_reward": false,
                "network": {
                    "output_size": 128,
                    "hidden_size": 256
                }
            },
            "enable_popart": true,
            "popart_beta": 0.999,
            "popart_epsilon": 1e-05,
            "learning_rate": 2e-04,
            "lr_policy": 2e-04,
            "lr_trunk": 2e-04,
            "lr_value_path": 2e-04,
            "lr_baseline_path": 2e-04,
            "lr_value_iqn": 2e-04,
            "lr_baseline_iqn": 2e-04,
            "lr_rnd_predictor": 2e-04,
            "lr_disagreement": 2e-04,
            "optimizer_betas": {
                "default": [
                    0.9,
                    0.999
                ],
                "policy": [
                    0.9,
                    0.999
                ],
                "trunk": [
                    0.9,
                    0.999
                ]
            },
            "weight_decay": {
                "default": 1e-05,
                "trunk": 1e-05,
                "policy": 1e-04,
                "value_path": 1e-04,
                "baseline_path": 1e-04
            },
            "gamma": 0.99,
            "lmbda": 0.95,
            "value_loss_coeff": 1.0,
            "baseline_loss_coeff": 0.25,
            "normalize_advantages": true,
            "max_grad_norm": 0.5,
            "ppo_clip_range": 0.2,
            "value_clip_range": 0.2,
            "entropy_coeff": 0.01,
            "schedulers": {
                "lr_trunk": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_policy": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_value_path": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_baseline_path": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_value_iqn": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_baseline_iqn": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_rnd_predictor": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "lr_disagreement": {
                    "start_factor": 1.0,
                    "end_factor": 0.1,
                    "total_iters": 10000
                },
                "entropy_coeff": {
                    "start_value": 0.01,
                    "end_value": 0.001,
                    "total_iters": 10000
                },
                "policy_clip": {
                    "start_value": 0.3,
                    "end_value": 0.1,
                    "total_iters": 10000
                },
                "value_clip": {
                    "start_value": 0.2,
                    "end_value": 0.1,
                    "total_iters": 10000
                },
                "max_grad_norm_disabled": {
                    "start_value": 0.5,
                    "end_value": 0.5,
                    "total_iters": 1
                }
            },
            "networks": {
                "MultiAgentEmbeddingNetwork": {
                    "cross_attention_feature_extractor": {
                        "agent_obs_size": 9,
                        "num_agents": 8,
                        "embed_dim": 48,
                        "num_heads": 4,
                        "transformer_layers": 2,
                        "dropout_rate": 0.1,
                        "use_agent_id": true,
                        "ff_hidden_factor": 2,
                        "id_num_freqs": 16,
                        "conv_init_scale": 1.0,
                        "linear_init_scale": 1.0,
                        "central_processing_configs": [
                            {
                                "name": "height_map",
                                "enabled": true,
                                "type": "cnn",
                                "cnn_stem_channels": [
                                    32,
                                    64,
                                    64
                                ],
                                "cnn_stem_kernels": [
                                    8,
                                    4,
                                    3
                                ],
                                "cnn_stem_strides": [
                                    4,
                                    2,
                                    1
                                ],
                                "cnn_stem_group_norms": [
                                    8,
                                    16,
                                    16
                                ],
                                "add_spatial_coords_to_cnn_input": true
                            },
                            {
                                "name": "gridobject_sequence",
                                "enabled": true,
                                "type": "linear_sequence",
                                "linear_stem_hidden_sizes": [
                                    64,
                                    64
                                ],
                                "add_positional_encoding": true
                            }
                        ]
                    },
                    "obs_encoder": {
                        "state_dim": 48,
                        "hidden_size": 48,
                        "output_size": 48,
                        "dropout_rate": 0.1,
                        "activation": true,
                        "layer_norm": true
                    },
                    "obs_actions_encoder": {
                        "state_dim": 48,
                        "action_dim": 6,
                        "hidden_size": 48,
                        "output_size": 48,
                        "dropout_rate": 0.1,
                        "activation": true,
                        "layer_norm": true
                    }
                },
                "policy_network": {
                    "type": "beta",
                    "in_features": 48,
                    "hidden_size": 64,
                    "param_init_bias": 0.0,
                    "min_concentration": 1.001,
                    "linear_init_scale": 0.1,
                    "dropout_rate": 0.1
                },
                "critic_network": {
                    "feature_dim_for_iqn": 48,
                    "value_head": {
                        "in_features": 48,
                        "hidden_size": 64,
                        "dropout_rate": 0.1
                    },
                    "baseline_head": {
                        "in_features": 48,
                        "hidden_size": 64,
                        "dropout_rate": 0.1
                    },
                    "value_attention": {
                        "embed_dim": 48,
                        "num_heads": 4,
                        "dropout": 0.1,
                        "self_attention": true
                    },
                    "baseline_attention": {
                        "embed_dim": 48,
                        "num_heads": 4,
                        "dropout": 0.1,
                        "self_attention": true
                    },
                    "iqn_params": {
                        "num_quantiles": 32,
                        "num_quantiles_prime": 32,
                        "kappa": 1.0,
                        "iqn_polyak": 0.005,
                        "iqn_epochs": 1,
                        "iqn_max_grad_norm": 0.5,
                        "value_iqn_loss_coeff": 0.5,
                        "baseline_iqn_loss_coeff": 0.25,
                        "iqn_target_update_freq": 1,
                        "iqn_batch_size": 64,
                        "iqn_replay_buffer_size": 50000,
                        "iqn_network": {
                            "feature_dim": 48,
                            "hidden_size": 128,
                            "quantile_embedding_dim": 128,
                            "linear_init_scale": 1.0,
                            "num_quantiles": 32,
                            "dropout_rate": 0.0
                        },
                        "distillation_network": {
                            "num_quantiles": 32,
                            "hidden_size": 128,
                            "combination_method": "hadamard_product",
                            "linear_init_scale": 1.0,
                            "dropout_rate": 0.0
                        }
                    }
                }
            }
        }
    },
    "train": {
        "sequence_length": 16,
        "pad_trajectories": true,
        "batch_size": 256,
        "buffer_size": 256,
        "num_environments": 8,
        "epochs": 3,
        "mini_batch_size": 8,
        "ActionRepeat": 8,
        "saveFrequency": 50,
        "state_normalizer": {
            "enabled": true,
            "clip": 10.0,
            "epsilon": 1e-08,
            "warmup_steps": 0
        },
        "rewards_normalizer": {
            "enabled": false,
            "gamma_disabled": 0.99,
            "clip": 10.0,
            "warmup_steps_disabled": 0,
            "epsilon": 1e-08
        }
    }
}